قالب
# خطة الاختبارات / Test Plan

> هذا الملف يُستخدم كقالب رسمي لخطة الاختبارات للمشروع.  
> يمكن تخصيصه لكل مشروع أو لكل Feature/Epic حسب الحاجة.

---

## 1. مقدمة / Introduction

### 1.1 الهدف من خطة الاختبار / Test Plan Objective

تهدف هذه الخطة إلى:

- تعريف أنواع الاختبارات التي سيتم تنفيذها (Unit, Integration, E2E, Smoke, Regression, Performance إذا لزم).
- تحديد نطاق الاختبار (In Scope / Out of Scope).
- توضيح بيئات الاختبار والأدوات المستخدمة.
- وضع معايير قبول واضحة (Acceptance Criteria) وجودة مخرجات الاختبار (Test KPIs).
- تنظيم مسؤوليات الفريق، وجدولة مراحل الاختبار ضمن دورة التطوير.

### 1.2 نطاق المشروع / Project Scope

- **In Scope (داخل النطاق):**
  - واجهات الـ API الأساسية (CRUD، عمليات البحث، الفلاتر، إلخ).
  - الواجهة الأمامية (Angular Components, Pages, Routing).
  - الدومين والـ Business Rules (الكيانات، الخدمات، CQRS، الأحداث).
  - الخلفيات (Background Jobs، الإشعارات، التقارير الأساسية).
- **Out of Scope (خارج النطاق مؤقتًا):**
  - اختبارات الأداء عالية الضغط (Load/Stress) إلا إذا تم تحديدها صراحة.
  - اختبارات أمن متقدمة (Penetration Testing) ما لم تُذكر في متطلبات غير وظيفية.

يمكن تعديل هذه القائمة لكل مشروع أو Feature حسب الحاجة.

---

## 2. مستويات وأنواع الاختبار / Test Levels & Types

### 2.1 مخطط عام / Overview

| المستوى / Level   | الوصف المختصر / Description                                   | المسؤول الرئيسي / Owner           |
|-------------------|----------------------------------------------------------------|------------------------------------|
| Unit Tests        | اختبار وحدات منطقية صغيرة (دوال، خدمات، قواعد دومين)          | Developer / Backend / Frontend     |
| Integration Tests | اختبار تكامل مكونات متعددة معًا (API + DB + Services)         | Developer / QA                     |
| E2E Tests         | محاكاة رحلة المستخدم الكاملة عبر الـ UI و الـ API والـ DB      | QA / Automation Engineer           |
| Smoke Tests       | اختبار سريع للتأكد من أن النظام يعمل ولا ينهار عند الإقلاع     | DevOps / QA                        |
| Regression Tests  | إعادة اختبار الميزات الأساسية بعد أي تعديل جوهري               | QA / Developer                     |

### 2.2 Unit Tests

#### الهدف / Goal

- التحقق من صحة منطق الكود في الوحدات الصغيرة (Domain Services, Application Services, Helpers, Validators، إلخ).

#### النطاق / Scope

- الدوال/الميثودز التي تحتوي منطقًا تجاريًا.
- قواعد التحقق (Validation) المهمة.
- حسابات النقاط، الأسعار، الحالات الخاصة (Edge Cases).

#### معايير الدخول / Entry Criteria

- الكود مكتوب وقابل للبناء (Build Succeeds).
- المتطلبات الوظيفية للوحدة واضحة.

#### معايير الخروج / Exit Criteria

- تغطية اختبارية مقبولة (مثلاً: 70%–80% من الدوال الحرجة).
- جميع اختبارات الـ Unit ذات الأولوية العالية تمر (Pass).

#### الأدوات / Tools

- Backend: xUnit / NUnit / MSTest (حسب المشروع).
- Frontend: Jest / Jasmine / Karma (حسب إعداد Angular).

---

### 2.3 Integration Tests

#### الهدف / Goal

- التحقق من أن الوحدات حين تُجمع معًا (مثل API + DB + Auth + Event Handlers) تعمل بدون مشاكل.

#### النطاق / Scope

- Endpoints أساسية (CRUD للكيانات المهمة).
- عمليات تستخدم DB حقيقية أو In-Memory DB.
- سيناريوهات تحوي Transaction / UnitOfWork.

#### Entry Criteria

- وجود بيئة اختبار جاهزة (Test Environment) متصلة بقاعدة بيانات اختبارية.
- وجود بيانات اختبار أولية (Seed/Test Data).

#### Exit Criteria

- نجاح جميع سيناريوهات التكامل الحرجة (Happy Paths + أهم Unhappy Paths).
- عدم وجود أخطاء Integration Blockers (مثل فشل حفظ البيانات، Exceptions غير معالَجة).

#### Tools

- Backend: xUnit + WebApplicationFactory (في .NET)، أو TestServer.
- Postman/Newman للاختبارات اليدوية/شبه المؤتمتة.

---

### 2.4 E2E (End-to-End) Tests

#### الهدف / Goal

- التأكد من أن رحلة المستخدم الكاملة (من الـ UI عبر الـ API إلى الـ DB ثم العودة إلى الـ UI) تعمل كما هو متوقع.

#### النطاق / Scope

- سيناريوهات استخدام رئيسية (Critical User Journeys)، مثل:
  - تسجيل الدخول / الخروج.
  - إنشاء كيان جديد (مثلاً: فعالية، منتج، عميل).
  - تحديث/حذف كيان.
  - البحث والتصفية.
  - خطوات متكاملة تشمل إشعارات/تقارير إن وجدت.

#### Entry Criteria

- البيئة مكتملة التشغيل (Frontend + Backend + DB).
- جميع Smoke Tests ناجحة.

#### Exit Criteria

- نجاح جميع سيناريوهات الـ E2E المحددة في الخطة.
- لا توجد أخطاء UX/UI تمنع إكمال المسار (Blockers).

#### Tools

- Playwright / Cypress / Selenium حسب تفضيل المشروع.

---

### 2.5 Smoke Tests

#### الهدف / Goal

- التأكد بسرعة أن النظام يعمل (No Crash) قبل الدخول في اختبارات أعمق.

#### أمثلة على Smoke Tests

- التحقق من أن الـ Backend يعمل ويستجيب على `/health` أو `/status`.
- التحقق من إمكانية الاتصال بقاعدة البيانات.
- التحقق من أن الصفحة الرئيسية للـ Frontend تعمل بدون أخطاء JavaScript حرجة.

---

### 2.6 Regression Tests (اختبارات التراجع)

#### الهدف / Goal

- ضمان أن الميزات الحالية لم تتأثر سلبًا بعد إضافة ميزة جديدة أو تعديل رئيسي.

#### النطاق / Scope

- مجموعة ثابتة من السيناريوهات الرئيسية (Critical Regression Suite)، يتم تشغيلها بعد كل Release أو Merge كبير.

---

## 3. بيئات الاختبار / Test Environments

### 3.1 أنواع البيئات

- **Local Development**: بيئة المطور (غالبًا باستخدام DB محلية أو In-Memory).
- **Test/Staging Environment**: بيئة مخصصة للاختبارات (تشبه الإنتاج قدر الإمكان).
- **Production (للمراقبة فقط)**: لا تجرى اختبارات تخريبية هنا، لكن يمكن مراقبة Telemetry/Logs.

### 3.2 إعدادات البيئة

لكل بيئة يجب تحديد:

- عنوان الـ API.
- إعدادات قاعدة البيانات.
- مفاتيح الربط مع الخدمات الخارجية (Mock/Real).
- الحسابات التجريبية (Test Users).

---

## 4. بيانات الاختبار / Test Data

### 4.1 أنواع بيانات الاختبار

- **Happy Path Data**: بيانات صحيحة تمثل الاستخدام العادي.
- **Edge Cases**: قيم حدودية (مثل العمر = 0، السعر = 0، تواريخ قصوى).
- **Invalid Data**: قيم خاطئة لاختبار التحقق من المدخلات.

### 4.2 إدارة بيانات الاختبار

- يمكن استخدام سكربتات Seed (مثلاً: SQL Scripts أو Seeders في .NET/ABP).
- يجب توفير آلية لإعادة تهيئة (Reset) بيانات الاختبار عند الحاجة.

---

## 5. خطة التنفيذ / Execution Plan

### 5.1 ترتيب مراحل الاختبار

1. Smoke Tests بعد كل Deploy إلى بيئة Test/Staging.
2. Unit Tests تُشغّل في CI على كل Pull Request.
3. Integration Tests تُشغّل على الفرع الرئيسي (main/develop) أو قبل Release.
4. E2E Tests تُشغّل على بيئة Test/Staging قبل إطلاق النسخة للإنتاج.
5. Regression Suite تُشغّل قبل كل Release مهم.

### 5.2 المسؤوليات / Responsibilities

- **Developers**:
  - كتابة Unit Tests + Integration Tests الأساسية.
- **QA / Test Engineer**:
  - تصميم سيناريوهات E2E + Regression.
  - متابعة نتائج الاختبار وإصدار تقارير.
- **DevOps**:
  - إعداد CI/CD لتشغيل الاختبارات تلقائيًا.

---

## 6. معايير القبول / Acceptance Criteria

أمثلة يمكن تعديلها حسب المشروع:

- نسبة نجاح Unit Tests لا تقل عن 90% للوظائف الحرجة.
- لا يوجد فشل في Smoke Tests على بيئة Test/Staging.
- جميع سيناريوهات E2E ذات الأولوية العالية ناجحة.
- لا توجد Bugs ذات أولوية High/Critical مفتوحة قبل الإطلاق.

---

## 7. مقاييس الجودة (KPIs) / Test KPIs

أمثلة على KPIs يمكن اعتمادها:

- **Test Coverage** (تغطية الكود بالاختبارات):  
  - Backend Critical Modules ≥ 80%  
  - Frontend Critical Components ≥ 70%
- **Defect Density**: عدد العيوب لكل Feature أو لكل 1000 سطر كود.
- **MTTR (Mean Time To Repair)**: متوسط زمن إصلاح العيوب الحرجة.
- **Flaky Tests Count**: عدد الاختبارات غير المستقرة (تنجح/تفشل بدون تغييرات حقيقية).

يمكن إضافة/تعديل KPIs حسب ما يناسب الفريق.

---

## 8. المخاطر والافتراضات / Risks & Assumptions

### 8.1 المخاطر المحتملة

- نقص بيانات اختبار واقعية.
- تأخير في تجهيز بيئة Test/Staging.
- غياب تغطية كافية لبعض الميزات القديمة.

### 8.2 الافتراضات

- توفر وقت كافٍ للمطورين لكتابة الاختبارات مع الميزات الجديدة.
- وجود دعم من DevOps لإعداد وتشغيل الاختبارات في الـ CI/CD.

---

## 9. مراجعة وتحديث خطة الاختبار

- يتم مراجعة هذا الملف دوريًا (مثلاً كل Sprint أو كل Release كبير).
- أي تحديثات كبيرة في المعمارية أو المتطلبات يجب أن يرافقها تحديث في خطة الاختبار.
